# 题库管理系统改进说明

## 修复时间
2025年12月19日

## 问题描述
1. 分页功能无法展示全部数据库中已经导入的题目
2. 导入其他学科内容无法正常加载
3. 科目管理功能缺失，导入题目时科目数据未被维护

## 改进内容

### 1. 分页插件优化
**文件**: `backend/src/main/java/com/exam/config/MybatisPlusConfig.java`

- 设置最大单页限制数量为1000，防止恶意查询
- 配置溢出处理策略
- 确保分页查询的稳定性和性能

### 2. 科目表自动管理系统
新增以下文件来实现科目表的自动维护：

#### 后端新增文件：
- `SubjectService.java` - 科目服务接口
- `SubjectServiceImpl.java` - 科目服务实现类
- `SubjectController.java` - 科目管理控制器
- `QuestionMapper.java` - 新增查询不同科目的方法

#### 前端新增文件：
- `frontend/src/api/subject.js` - 科目相关API接口

### 3. 导入功能增强
**修改文件**:
- `ChoiceQuestionImportListener.java` - 选择题导入监听器
- `JudgeQuestionImportListener.java` - 判断题导入监听器
- `ImportController.java` - 导入控制器

**改进内容**:
- 导入题目时自动统计各科目的题目数量
- 导入完成后自动更新subject表
- 支持多科目批量导入

### 4. 题目增删改操作同步科目表
**修改文件**:
- `QuestionService.java` - 新增同步科目表的方法
- `QuestionServiceImpl.java` - 实现科目表同步逻辑
- `QuestionController.java` - 使用新的Service方法

**改进功能**:
- 添加题目：自动增加对应科目的题目计数
- 更新题目：如果科目变化，自动更新两个科目的计数
- 删除题目：自动减少对应科目的题目计数
- 批量删除：批量更新各科目的计数
- 清空题库：批量更新各科目的计数

### 5. 前端动态科目加载
**修改文件**: `frontend/src/views/QuestionManage.vue`

**改进内容**:
- 页面加载时自动从后端获取科目列表
- 科目下拉框显示题目数量统计
- 支持输入新科目（filterable + tag）
- 导入题目后自动刷新科目列表

### 6. 数据初始化脚本
**新增文件**: `初始化科目表.sql`

用于处理已有数据，统计现有题目并初始化subject表。

## API接口说明

### 科目管理接口

#### 1. 获取所有科目列表
```
GET /api/subjects
```
返回所有科目及其题目数量，按题目数量倒序排列。

#### 2. 重新统计所有科目
```
POST /api/subjects/recount
```
重新统计数据库中所有科目的题目数量。

#### 3. 重新统计指定科目
```
POST /api/subjects/recount/{subjectName}
```
重新统计指定科目的题目数量。

## 使用说明

### 首次使用（已有数据）
1. 执行 `初始化科目表.sql` 脚本初始化科目数据
2. 或者访问 `/api/subjects/recount` 接口自动统计

### 日常使用
- 导入题目：系统自动维护科目表
- 添加/编辑题目：可以选择已有科目或输入新科目
- 删除题目：系统自动更新科目统计
- 查看题目：可以按科目筛选

## 技术特点

1. **事务管理**：所有涉及科目表更新的操作都使用 `@Transactional` 保证数据一致性
2. **批量处理**：导入和批量删除时统一更新科目表，提高性能
3. **数据同步**：所有题目的增删改操作都会同步更新科目表
4. **前后端分离**：科目数据完全由后端管理，前端动态加载

## 注意事项

1. 如果有历史数据，请先执行初始化脚本
2. 科目名称为空时会自动设置为"未分类"
3. 题目数量统计可能因历史原因不准确，可以使用重新统计接口
4. 删除科目功能暂未实现，需要时可以手动删除题目数量为0的科目

## 测试建议

1. 测试导入不同科目的题目
2. 测试添加/编辑/删除题目后科目表的变化
3. 测试批量删除和清空题库功能
4. 测试分页功能是否正常展示所有数据
5. 验证前端科目下拉框是否正确显示

## 后续优化建议

1. 添加科目管理页面（增删改查）
2. 添加科目统计图表
3. 支持科目重命名功能
4. 添加科目导入导出功能
5. 优化大数据量下的性能
